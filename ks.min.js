// Ks Â© 2014 Andrey Polischuk
// https://github.com/andrepolischuk/ks
!function(){"use strict";function t(t){return d[t.toLowerCase()]||t.toUpperCase().charCodeAt(0)}function e(t){var e;for(var n in d)d.hasOwnProperty(n)&&(e=d[n]===t?n:e);return e||String.fromCharCode(t).toLowerCase()}function n(t,e){e=e||v.context;for(var n=0;n<e.length;n++)if(e[n]===t)return n;return null}function r(t){t=t||{},t.keyCode?delete v.keys[e(t.keyCode)]:(v.target={},v.keys={},v.fn=v.fn||null)}function o(t,e,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent("on"+e,function(){n.call(t,window.event)})}function a(t,e){var r=null===t.target||null===e.target&&e.target===t.target||t.target.id.length&&t.target.id===e.target.id||t.target.tag.length&&t.target.tag===e.target.tag||!1,o=0,a=0;for(var i in e.keys)e.keys.hasOwnProperty(i)&&(o+=i in t.keys?1:0);for(i in t.keys)t.keys.hasOwnProperty(i)&&a++;var c=null===t.context||t.context===e.context;return c=t.context&&"object"==typeof e.context?null!==n(t.context,e.context):c,r&&c&&o===a&&t.altKey===e.altKey&&t.ctrlKey===e.ctrlKey&&t.shiftKey===e.shiftKey}function i(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]="[object Object]"===Object.prototype.toString.call(t[n])?i(t[n]):t[n]);return e}function c(t){var n=e(t.keyCode);if(!(t.keyCode>15&&t.keyCode<19)){"number"!=typeof v.keys[n]&&(v.keys[n]=t.keyCode,t.target=t.target||t.srcElement,v.target.id=t.target.id.length?"#"+t.target.id:"",v.target.tag=t.target.tagName.toLowerCase(),v.altKey=t.altKey,v.ctrlKey=t.ctrlKey,v.shiftKey=t.shiftKey);for(var r=0;r<y.length;r++)if(a(y[r],v))return t.preventDefault?t.preventDefault():t.returnValue=!1,void y[r].fn.call(t.target,i(y[r]));"function"==typeof v.fn&&v.fn.call(t.target,i(v))}}function f(e){var n={};e=e.replace(/\s/g,"").split("+"),n.keys={},n.altKey=!1,n.ctrlKey=!1,n.shiftKey=!1;for(var r=0;r<e.length;r++)e[r]=e[r].toLowerCase(),e[r]in g?(n.altKey=n.altKey||"alt"===e[r]||"option"===e[r],n.ctrlKey=n.ctrlKey||"ctrl"===e[r]||"control"===e[r],n.shiftKey=n.shiftKey||"shift"===e[r]):n.keys[e[r]]=t(e[r]);return n}function l(t){var e={};return e.id="",e.tag="",e[/^#.+$/g.test(t)?"id":"tag"]=t,e}function u(t,e,n,r){var o=f(t);o.target=e?l(e):e,o.fn=n,o.context=r?r.substr(1):r,y.push(o)}function s(t,e,n,r){return"function"==typeof t?void(v.fn=t):(r="string"==typeof n?n:r||null,n="function"==typeof e?e:n,e="string"==typeof e?e:null,void("function"==typeof n&&u(t,e,n,r)))}for(var y=[],g={ctrl:17,control:17,alt:18,option:18,shift:16},d={escape:27,esc:27,"`":192,"-":189,"=":187,backspace:8,tab:9,"\\":220,"[":219,"]":221,";":186,"'":222,enter:13,"return":13,",":188,".":190,"/":191,space:32,pause:19,insert:45,"delete":46,home:36,end:35,pageup:33,pagedown:34,left:37,up:38,right:39,down:40},p=1;20>p;p++)d["f"+p]=111+p;var v={};r(),v.context=[],s.remove=function(t,e,n){if("string"==typeof t){e&&"@"===e.substr(0,1)&&(n=e,e=null);var r=f(t);r.target=l(e),r.context=n?n.substr(1):n;for(var o=0;o<y.length;o++)a(y[o],r)&&(y.splice(o,1),o--)}},s.context=function(t){return t&&null===n(t)&&v.context.push(t),v.context},s.removeContext=function(t){var e=n(t);return"undefined"==typeof t?v.context=[]:null!==e&&v.context.splice(e,1),v.context},o(document,"keydown",c),o(document,"keyup",r),o(window,"blur",r),"function"==typeof define&&define.amd?define([],function(){return s}):"undefined"!=typeof module&&module.exports?module.exports=s:this.ks=s}.call(this);
