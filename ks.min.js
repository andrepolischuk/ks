// Ks Â© 2014 Andrey Polischuk
// https://github.com/andrepolischuk/ks
!function(){"use strict";function e(a){return c[a.toLowerCase()]||a.toUpperCase().charCodeAt(0)}function f(a){var b;for(var d in c)c.hasOwnProperty(d)&&(b=c[d]===a?d:b);return b||String.fromCharCode(a).toLowerCase()}function g(a,b){b=b||h.context;for(var c=0;c<b.length;c++)if(b[c]===a)return c;return null}function i(a){a=a||window.event||{},a.keyCode?delete h.keys[f(a.keyCode)]:(h.target={},h.keys={},h.fn=h.fn||null)}function j(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)}function k(a,b){var c=!a.target.id.length&&!a.target.tag.length||a.target.id.length&&a.target.id===b.target.id||a.target.tag.length&&a.target.tag===b.target.tag||!1,d=0,e=0;for(var f in b.keys)b.keys.hasOwnProperty(f)&&(d+=f in a.keys?1:0);for(f in a.keys)a.keys.hasOwnProperty(f)&&e++;var h=null===a.context||a.context===b.context;return h=a.context&&"object"==typeof b.context?null!==g(a.context,b.context):h,c&&h&&d===e&&a.altKey===b.altKey&&a.ctrlKey===b.ctrlKey&&a.shiftKey===b.shiftKey}function l(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]="[object Object]"===Object.prototype.toString.call(a[c])?l(a[c]):a[c]);return b}function m(b){b=b||window.event;var c=f(b.keyCode);if(!(c in h.keys||b.keyCode>15&&b.keyCode<19)){h.keys[c]=b.keyCode,b.target=b.target||b.srcElement,h.target.id=b.target.id.length?"#"+b.target.id:"",h.target.tag=b.target.tagName.toLowerCase(),h.altKey=b.altKey,h.ctrlKey=b.ctrlKey,h.shiftKey=b.shiftKey;for(var d=0;d<a.length;d++)if(k(a[d],h))return b.preventDefault?b.preventDefault():b.returnValue=!1,a[d].fn.call(b.target,l(a[d])),void 0;"function"==typeof h.fn&&h.fn.call(b.target,l(h))}}function n(a){var c={};a=a.replace(/\s/g,"").split("+"),c.keys={},c.altKey=!1,c.ctrlKey=!1,c.shiftKey=!1;for(var d=0;d<a.length;d++)a[d]=a[d].toLowerCase(),a[d]in b?(c.altKey=c.altKey||"alt"===a[d]||"option"===a[d],c.ctrlKey=c.ctrlKey||"ctrl"===a[d]||"control"===a[d],c.shiftKey=c.shiftKey||"shift"===a[d]):c.keys[a[d]]=e(a[d]);return c}function o(a){var b={};return b.id="",b.tag="",b[/^#.+$/g.test(a)?"id":"tag"]=a,b}function p(b,c,d,e){var f=n(b);f.target=o(c),f.fn=d,f.context=e,a.push(f)}function q(a,b,c,d){return"function"==typeof a?(h.fn=a,void 0):(d="string"==typeof c?c:d||null,c="function"==typeof b?b:c,b="string"==typeof b?b:"","function"==typeof c&&p(a,b,c,d),void 0)}for(var a=[],b={ctrl:17,control:17,alt:18,option:18,shift:16},c={escape:27,esc:27,"`":192,"-":189,"=":187,backspace:8,tab:9,"\\":220,"[":219,"]":221,";":186,"'":222,enter:13,"return":13,",":188,".":190,"/":191,space:32,pause:19,insert:45,"delete":46,home:36,end:35,pageup:33,pagedown:34,left:37,up:38,right:39,down:40},d=1;20>d;d++)c["f"+d]=111+d;var h={};i(),h.context=[],q.remove=function(b,c,d){if("string"==typeof b){var e=n(b);e.target=o(c),e.context=d;for(var f=0;f<a.length;f++)k(a[f],e)&&(a.splice(f,1),f--)}},q.context=function(a){return a&&null===g(a)&&h.context.push(a),h.context},q.removeContext=function(a){var b=g(a);return"undefined"==typeof a?h.context=[]:null!==b&&h.context.splice(b,1),h.context},j(document,"keydown",m),j(document,"keyup",i),j(window,"blur",i),"function"==typeof define&&define.amd?define([],function(){return q}):"undefined"!=typeof module&&module.exports?module.exports=q:this.ks=q}.call(this);
