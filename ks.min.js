// Ks Â© 2014 Andrey Polischuk
// https://github.com/andrepolischuk/ks
!function(){"use strict";function f(a){return d[a.toLowerCase()]||a.toUpperCase().charCodeAt(0)}function g(a){var b;for(var c in d)d.hasOwnProperty(c)&&(b=d[c]===a?c:b);return b||String.fromCharCode(a).toLowerCase()}function i(a){delete h.keys[g(a.keyCode)]}function j(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,function(){c(window.event)})}function k(a,b){var c=!a.target.id.length&&!a.target.tag.length||a.target.id.length&&a.target.id===b.target.id||a.target.tag.length&&a.target.tag===b.target.tag||!1,d=0,e=0;for(var f in b.keys)b.keys.hasOwnProperty(f)&&(d+=f in a.keys?1:0);for(f in a.keys)a.keys.hasOwnProperty(f)&&e++;return c&&d===e&&a.altKey===b.altKey&&a.ctrlKey===b.ctrlKey&&a.shiftKey===b.shiftKey}function l(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]="object"==typeof a[c]?l(a[c]):a[c]);return b}function m(a){var c=g(a.keyCode);if(!(c in h.keys||a.keyCode>15&&a.keyCode<19)){h.keys[c]=a.keyCode,a.target=a.target||a.srcElement,h.target.id=a.target.id.length?"#"+a.target.id:"",h.target.tag=a.target.tagName.toLowerCase(),h.altKey=a.altKey,h.ctrlKey=a.ctrlKey,h.shiftKey=a.shiftKey;for(var d=0;d<b.length;d++)if(k(b[d],h))return b[d].fn.call(a.target,l(b[d])),void 0;"function"==typeof h.fn&&h.fn.call(a.target,l(h))}}function n(a){var b={};a=a.replace(/\s/g,"").split("+"),b.keys={},b.altKey=!1,b.ctrlKey=!1,b.shiftKey=!1;for(var d=0;d<a.length;d++)a[d]in c?(b.altKey=b.altKey||"alt"===a[d]||"option"===a[d],b.ctrlKey=b.ctrlKey||"ctrl"===a[d]||"control"===a[d],b.shiftKey=b.shiftKey||"shift"===a[d]):b.keys[a[d]]=f(a[d]);return b}function o(a){var b={};return b.id="",b.tag="",b[/^#.+$/g.test(a)?"id":"tag"]=a,b}function p(a,c,d){var e=n(a);e.target=o(c),e.fn=d,b.push(e)}function q(a,b,c){return"function"==typeof a?(h.fn=a,void 0):(c="function"==typeof b?b:c,b="string"==typeof b?b:"","function"==typeof c&&"string"==typeof a&&p(a,b,c),void 0)}for(var b=[],c={ctrl:17,control:17,alt:18,option:18,shift:16},d={escape:27,esc:27,"`":192,"-":189,"=":187,backspace:8,tab:9,"\\":220,"[":219,"]":221,";":186,"'":222,enter:13,"return":13,",":188,".":190,"/":191,space:32,pause:19,insert:45,"delete":46,home:36,end:35,pageup:33,pagedown:34,left:37,up:38,right:39,down:40},e=1;20>e;e++)d["f"+e]=111+e;var h={};h.target={},h.keys={},h.fn=null,q.remove=function(a,c){if("string"==typeof a){var d=n(a);d.target=o(c);for(var e=0;e<b.length;e++)k(b[e],d)&&(b.splice(e,1),e--)}},j(document,"keydown",m),j(document,"keyup",i),"function"==typeof define&&define.amd?define([],function(){return q}):"undefined"!=typeof module&&module.exports?module.exports=q:this.ks=q}.call(this);
